# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               clang_dependency 1.0

if {${os.major} < 18} {
    # prior to 10.14, universal usually means different library bit depths
    # if different library bit depths are required, then we
    # have to build separately and lipo together
    PortGroup muniversal 1.0

}

name                    icu
categories              devel textproc
platforms               darwin
maintainers             {kencu @kencu} openmaintainer
license                 Permissive
description             International Components for Unicode
long_description        {*}${description} (ICU) support libraries.

homepage                http://site.icu-project.org/

version                 68.2
revision                0
checksums               rmd160  596bd53b17bd85a872f0731679e2f1c664e3bae6 \
			sha256  c79193dee3907a2199b8296a93b52c5cb74332c26f3d167269487680d479d625 \
			size    24737478

compiler.cxx_standard   2011

master_sites            https://github.com/unicode-org/icu/releases/download/release-[string map {. -} ${version}]/
distname                icu4c-[string map {. _} ${version}]-src
extract.suffix          .tgz

# use full path to libraries when building tools
patchfiles-append       patch-config-mh-darwin.diff

# clear these
configure.cppflags
configure.ldflags

worksrcdir              ${name}/source

configure.args          --disable-layoutex \
                        --disable-samples  \
                        --disable-tests    \
                        --enable-static    \
			--with-library-bits=64

if {${configure.build_arch} in "i386 ppc"} {
    configure.args-replace --with-library-bits=64 --with-library-bits=32
}

build.args-append       VERBOSE=1

variant tests description "enable tests" {
    test.run                yes
    configure.args-replace --disable-tests --enable-tests
    test.target             check
    test.args-append        VERBOSE=1
}

if {${os.major} < 11} {
	depends_build-append    port:python27
	license_noconflict      python27
	configure.python        ${prefix}/bin/python2.7
}

platform darwin 8 {
	patchfiles-append   patch-common-putil.cpp.diff
}

livecheck.url       http://site.icu-project.org/download
livecheck.regex     "ICU4C-Download\">(\[0-9.\]+)"
